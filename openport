sudo tee /usr/local/bin/openport > /dev/null << 'EOF'
#!/bin/bash

if [ "$#" -ne 1 ]; then
  echo "usage: openport <port>"
  exit 1
fi

PORT="$1"

sudo apt-get update -qq > /dev/null
sudo apt-get install -y openssh-server > /dev/null
sudo systemctl enable --now ssh > /dev/null

sudo sed -i 's/^#PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config > /dev/null
sudo sed -i 's/^#PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config > /dev/null
sudo sed -i "s/^Port .*/Port $PORT/" /etc/ssh/sshd_config > /dev/null
sudo systemctl restart ssh > /dev/null

IP=$(hostname -I | awk '{print $1}') || IP=$(ip a | grep -w 'inet' | grep -v '127.0.0.1' | awk '{print $2}' | cut -d'/' -f1)

echo "SSH is on ${IP}:${PORT}, command is ssh root@${IP} -p ${PORT}"
EOF
